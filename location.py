from xml.dom import minidom
import fuzzy
import operator
from coordinates import Coordinates
import httplib2
import urllib

class Location:
    def __init__(self, state=None, district=None):
        if state is not None:
            if type(state) == type(""):
                self.state_code = self.__getStateCode(state)
            else:
                self.state_code = str(state)
        else:
            self.state_code = ""
        if district is not None:
            if type(district) == type(""):
                self.district_code = self.__getDistrictCode(district, self.state_code)
            else:
                self.district_code = str(district)
        else:
            self.district_code = ""

    __states_with_id = [{"id":"04","name":"Chandigarh"},{"id":"35","name":"Andamans & Nicobars"},{"id":"28","name":"Andhra Pradesh"},{"id":"12","name":"Arunachal Pradesh"},{"id":"18","name":"Assam"},{"id":"10","name":"Bihar"},{"id":"22","name":"Chhattisgarh"},{"id":"26","name":"Dadra & Nagar Haveli"},{"id":"25","name":"Daman & Diu"},{"id":"07","name":"Delhi"},{"id":"30","name":"Goa"},{"id":"24","name":"Gujarat"},{"id":"06","name":"Haryana"},{"id":"02","name":"Himachal Pradesh"},{"id":"01","name":"Jammu & Kashmir"},{"id":"20","name":"Jharkhand"},{"id":"29","name":"Karnataka"},{"id":"32","name":"Kerala"},{"id":"31","name":"Lakshadweep"},{"id":"23","name":"Madhya Pradesh"},{"id":"27","name":"Maharashtra"},{"id":"14","name":"Manipur"},{"id":"17","name":"Meghalaya"},{"id":"15","name":"Mizoram"},{"id":"13","name":"Nagaland"},{"id":"21","name":"Orissa"},{"id":"34","name":"Pondicherry"},{"id":"03","name":"Punjab"},{"id":"08","name":"Rajasthan"},{"id":"11","name":"Sikkim"},{"id":"33","name":"Tamil Nadu"},{"id":"16","name":"Tripura"},{"id":"09","name":"Uttar Pradesh"},{"id":"05","name":"Uttranchal"},{"id":"19","name":"West Bengal"}]
    __districts_with_id = [{"id":"2801","name":"Adilabad"},{"id":"0915","name":"Agra"},{"id":"2407","name":"Ahmadabad"},{"id":"2726","name":"Ahmadnagar"},{"id":"1503","name":"Aizawl"},{"id":"0821","name":"Ajmer"},{"id":"2705","name":"Akola"},{"id":"3211","name":"Alappuzha"},{"id":"0912","name":"Aligarh"},{"id":"0945","name":"Allahabad"},{"id":"0509","name":"Almora"},{"id":"0806","name":"Alwar"},{"id":"0602","name":"Ambala"},{"id":"0948","name":"Ambedkar Nagar"},{"id":"2707","name":"Amravati"},{"id":"2413","name":"Amreli"},{"id":"0302","name":"Amritsar"},{"id":"2415","name":"Anand"},{"id":"2822","name":"Anantapur"},{"id":"0106","name":"Anantnag"},{"id":"3501","name":"Andamans"},{"id":"2115","name":"Anugul"},{"id":"1007","name":"Araria"},{"id":"3317","name":"Ariyalur"},{"id":"0932","name":"Auraiya"},{"id":"1034","name":"Aurangabad"},{"id":"2719","name":"Aurangabad"},{"id":"0961","name":"Azamgarh"},{"id":"0104","name":"Badgam"},{"id":"2902","name":"Bagalkot"},{"id":"0508","name":"Bageshwar"},{"id":"0908","name":"Baghpat"},{"id":"0950","name":"Bahraich"},{"id":"2345","name":"Balaghat"},{"id":"2124","name":"Balangir"},{"id":"2108","name":"Baleshwar"},{"id":"0963","name":"Ballia"},{"id":"0952","name":"Balrampur"},{"id":"2402","name":"Banas Kantha"},{"id":"0940","name":"Banda"},{"id":"2920","name":"Bangalore"},{"id":"2921","name":"Bangalore Rural"},{"id":"1023","name":"Banka"},{"id":"1913","name":"Bankura"},{"id":"0828","name":"Banswara"},{"id":"0946","name":"Barabanki"},{"id":"0102","name":"Baramula"},{"id":"0831","name":"Baran"},{"id":"1909","name":"Barddhaman"},{"id":"0920","name":"Bareilly"},{"id":"2101","name":"Bargarh"},{"id":"0817","name":"Barmer"},{"id":"1805","name":"Barpeta"},{"id":"2328","name":"Barwani"},{"id":"2215","name":"Bastar"},{"id":"0955","name":"Basti"},{"id":"0314","name":"Bathinda"},{"id":"2122","name":"Baudh"},{"id":"1020","name":"Begusarai"},{"id":"2901","name":"Belgaum"},{"id":"2912","name":"Bellary"},{"id":"2335","name":"Betul"},{"id":"2109","name":"Bhadrak"},{"id":"1022","name":"Bhagalpur"},{"id":"2710","name":"Bhandara"},{"id":"0807","name":"Bharatpur"},{"id":"2421","name":"Bharuch"},{"id":"2414","name":"Bhavnagar"},{"id":"0824","name":"Bhilwara"},{"id":"2303","name":"Bhind"},{"id":"0613","name":"Bhiwani"},{"id":"1029","name":"Bhojpur"},{"id":"2332","name":"Bhopal"},{"id":"2727","name":"Bid"},{"id":"2905","name":"Bidar"},{"id":"2903","name":"Bijapur"},{"id":"0903","name":"Bijnor"},{"id":"0803","name":"Bikaner"},{"id":"2207","name":"Bilaspur"},{"id":"0208","name":"Bilaspur"},{"id":"1908","name":"Birbhum"},{"id":"1404","name":"Bishnupur"},{"id":"2013","name":"Bokaro"},{"id":"1804","name":"Bongaigaon"},{"id":"0919","name":"Budaun"},{"id":"0911","name":"Bulandshahr"},{"id":"2704","name":"Buldana"},{"id":"0823","name":"Bundi"},{"id":"1030","name":"Buxar"},{"id":"1821","name":"Cachar"},{"id":"0706","name":"Central"},{"id":"2927","name":"Chamarajanagar"},{"id":"0201","name":"Chamba"},{"id":"0502","name":"Chamoli"},{"id":"0510","name":"Champawat"},{"id":"1504","name":"Champhai"},{"id":"0966","name":"Chandauli"},{"id":"1409","name":"Chandel"},{"id":"0401","name":"Chandigarh"},{"id":"2713","name":"Chandrapur"},{"id":"1212","name":"Changlang"},{"id":"2003","name":"Chatra"},{"id":"3302","name":"Chennai"},{"id":"2309","name":"Chhatarpur"},{"id":"2343","name":"Chhindwara"},{"id":"2917","name":"Chikmagalur"},{"id":"2913","name":"Chitradurga"},{"id":"0941","name":"Chitrakoot"},{"id":"0829","name":"Chittaurgarh"},{"id":"2823","name":"Chittoor"},{"id":"1403","name":"Churachandpur"},{"id":"0804","name":"Churu"},{"id":"3312","name":"Coimbatore"},{"id":"3318","name":"Cuddalore"},{"id":"2820","name":"Cuddapah"},{"id":"2112","name":"Cuttack"},{"id":"2601","name":"Dadra & Nagar Haveli"},{"id":"1905","name":"Dakshin Dinajpur"},{"id":"2924","name":"Dakshina Kannada"},{"id":"2502","name":"Daman"},{"id":"2312","name":"Damoh"},{"id":"2216","name":"Dantewada"},{"id":"1013","name":"Darbhanga"},{"id":"1901","name":"Darjiling"},{"id":"1808","name":"Darrang"},{"id":"2305","name":"Datia"},{"id":"0811","name":"Dausa"},{"id":"2914","name":"Davanagere"},{"id":"2104","name":"Debagarh"},{"id":"0505","name":"Dehradun"},{"id":"2007","name":"Deoghar"},{"id":"0960","name":"Deoria"},{"id":"2323","name":"Dewas"},{"id":"1603","name":"Dhalai"},{"id":"2213","name":"Dhamtari"},{"id":"2012","name":"Dhanbad"},{"id":"2325","name":"Dhar"},{"id":"3305","name":"Dharmapuri"},{"id":"2909","name":"Dharwad"},{"id":"0808","name":"Dhaulpur"},{"id":"1813","name":"Dhemaji"},{"id":"2114","name":"Dhenkanal"},{"id":"1802","name":"Dhubri"},{"id":"2702","name":"Dhule"},{"id":"1210","name":"Dibang Valley"},{"id":"1815","name":"Dibrugarh"},{"id":"1306","name":"Dimapur"},{"id":"3313","name":"Dindigul"},{"id":"2341","name":"Dindori"},{"id":"2501","name":"Diu"},{"id":"0109","name":"Doda"},{"id":"2418","name":"Dohad"},{"id":"2011","name":"Dumka"},{"id":"0827","name":"Dungarpur"},{"id":"2210","name":"Durg"},{"id":"0704","name":"East"},{"id":"1104","name":"East"},{"id":"1702","name":"East Garo Hills"},{"id":"2814","name":"East Godavari"},{"id":"1203","name":"East Kameng"},{"id":"1706","name":"East Khasi Hills"},{"id":"2329","name":"East Nimar"},{"id":"1208","name":"East Siang"},{"id":"3208","name":"Ernakulam"},{"id":"3310","name":"Erode"},{"id":"0917","name":"Etah"},{"id":"0931","name":"Etawah"},{"id":"0947","name":"Faizabad"},{"id":"0619","name":"Faridabad"},{"id":"0313","name":"Faridkot"},{"id":"0929","name":"Farrukhabad"},{"id":"0610","name":"Fatehabad"},{"id":"0308","name":"Fatehgarh Sahib"},{"id":"0942","name":"Fatehpur"},{"id":"0916","name":"Firozabad"},{"id":"0311","name":"Firozpur"},{"id":"2908","name":"Gadag"},{"id":"2712","name":"Gadchiroli"},{"id":"2120","name":"Gajapati"},{"id":"2406","name":"Gandhinagar"},{"id":"0801","name":"Ganganagar"},{"id":"2119","name":"Ganjam"},{"id":"2001","name":"Garhwa"},{"id":"0506","name":"Garhwal"},{"id":"0910","name":"Gautam Buddha Nagar"},{"id":"1035","name":"Gaya"},{"id":"0909","name":"Ghaziabad"},{"id":"0965","name":"Ghazipur"},{"id":"2006","name":"Giridih"},{"id":"1803","name":"Goalpara"},{"id":"2008","name":"Godda"},{"id":"1818","name":"Golaghat"},{"id":"0953","name":"Gonda"},{"id":"2711","name":"Gondiya"},{"id":"1015","name":"Gopalganj"},{"id":"0958","name":"Gorakhpur"},{"id":"2904","name":"Gulbarga"},{"id":"2016","name":"Gumla"},{"id":"2307","name":"Guna"},{"id":"2817","name":"Guntur"},{"id":"0301","name":"Gurdaspur"},{"id":"0618","name":"Gurgaon"},{"id":"2304","name":"Gwalior"},{"id":"1823","name":"Hailakandi"},{"id":"0938","name":"Hamirpur"},{"id":"0206","name":"Hamirpur"},{"id":"0802","name":"Hanumangarh"},{"id":"1916","name":"Haora"},{"id":"2336","name":"Harda"},{"id":"0925","name":"Hardoi"},{"id":"0513","name":"Hardwar"},{"id":"2923","name":"Hassan"},{"id":"0913","name":"Hathras"},{"id":"2911","name":"Haveri"},{"id":"2004","name":"Hazaribag"},{"id":"2716","name":"Hingoli"},{"id":"0612","name":"Hisar"},{"id":"2337","name":"Hoshangabad"},{"id":"0305","name":"Hoshiarpur"},{"id":"1912","name":"Hugli"},{"id":"2805","name":"Hyderabad"},{"id":"3209","name":"Idukki"},{"id":"1407","name":"Imphal East"},{"id":"1406","name":"Imphal West"},{"id":"2326","name":"Indore"},{"id":"2339","name":"Jabalpur"},{"id":"2111","name":"Jagatsinghapur"},{"id":"1707","name":"Jaintia Hills"},{"id":"0812","name":"Jaipur"},{"id":"0816","name":"Jaisalmer"},{"id":"2113","name":"Jajapur"},{"id":"0304","name":"Jalandhar"},{"id":"0935","name":"Jalaun"},{"id":"2703","name":"Jalgaon"},{"id":"2718","name":"Jalna"},{"id":"0818","name":"Jalor"},{"id":"1902","name":"Jalpaiguri"},{"id":"0113","name":"Jammu"},{"id":"2410","name":"Jamnagar"},{"id":"1037","name":"Jamui"},{"id":"2206","name":"Janjgir - Champa"},{"id":"2203","name":"Jashpur"},{"id":"0964","name":"Jaunpur"},{"id":"1033","name":"Jehanabad"},{"id":"2324","name":"Jhabua"},{"id":"0615","name":"Jhajjar"},{"id":"0832","name":"Jhalawar"},{"id":"0936","name":"Jhansi"},{"id":"2102","name":"Jharsuguda"},{"id":"0805","name":"Jhunjhunun"},{"id":"0609","name":"Jind"},{"id":"0815","name":"Jodhpur"},{"id":"1817","name":"Jorhat"},{"id":"2412","name":"Junagadh"},{"id":"0906","name":"Jyotiba Phule Nagar"},{"id":"2401","name":"Kachchh"},{"id":"1031","name":"Kaimur (Bhabua)"},{"id":"0605","name":"Kaithal"},{"id":"2126","name":"Kalahandi"},{"id":"1806","name":"Kamrup"},{"id":"3303","name":"Kancheepuram"},{"id":"2121","name":"Kandhamal"},{"id":"0202","name":"Kangra"},{"id":"2214","name":"Kanker"},{"id":"0930","name":"Kannauj"},{"id":"3330","name":"Kanniyakumari"},{"id":"3202","name":"Kannur"},{"id":"0933","name":"Kanpur Dehat"},{"id":"0934","name":"Kanpur Nagar"},{"id":"0303","name":"Kapurthala"},{"id":"3404","name":"Karaikal"},{"id":"0809","name":"Karauli"},{"id":"1819","name":"Karbi Anglong"},{"id":"0108","name":"Kargil"},{"id":"1822","name":"Karimganj"},{"id":"2803","name":"Karimnagar"},{"id":"0606","name":"Karnal"},{"id":"3314","name":"Karur"},{"id":"3201","name":"Kasaragod"},{"id":"0114","name":"Kathua"},{"id":"1010","name":"Katihar"},{"id":"2338","name":"Katni"},{"id":"0944","name":"Kaushambi"},{"id":"2208","name":"Kawardha"},{"id":"2110","name":"Kendrapara"},{"id":"2106","name":"Kendujhar"},{"id":"1021","name":"Khagaria"},{"id":"2810","name":"Khammam"},{"id":"2416","name":"Kheda"},{"id":"0923","name":"Kheri"},{"id":"2117","name":"Khordha"},{"id":"0212","name":"Kinnaur"},{"id":"1008","name":"Kishanganj"},{"id":"1903","name":"Koch Bihar"},{"id":"2925","name":"Kodagu"},{"id":"2005","name":"Kodarma"},{"id":"1307","name":"Kohima"},{"id":"1801","name":"Kokrajhar"},{"id":"2919","name":"Kolar"},{"id":"1502","name":"Kolasib"},{"id":"2734","name":"Kolhapur"},{"id":"1917","name":"Kolkata"},{"id":"3213","name":"Kollam"},{"id":"2907","name":"Koppal"},{"id":"2129","name":"Koraput"},{"id":"2205","name":"Korba"},{"id":"2201","name":"Koriya"},{"id":"0830","name":"Kota"},{"id":"3210","name":"Kottayam"},{"id":"3204","name":"Kozhikode"},{"id":"2816","name":"Krishna"},{"id":"0204","name":"Kullu"},{"id":"0101","name":"Kupwara"},{"id":"2821","name":"Kurnool"},{"id":"0604","name":"Kurukshetra"},{"id":"0959","name":"Kushinagar"},{"id":"0203","name":"Lahul & Spiti"},{"id":"1812","name":"Lakhimpur"},{"id":"1025","name":"Lakhisarai"},{"id":"3101","name":"Lakshadweep"},{"id":"0937","name":"Lalitpur"},{"id":"2728","name":"Latur"},{"id":"1507","name":"Lawngtlai"},{"id":"0107","name":"Leh (Ladakh)"},{"id":"2015","name":"Lohardaga"},{"id":"1211","name":"Lohit"},{"id":"1205","name":"Lower Subansiri"},{"id":"0927","name":"Lucknow"},{"id":"0309","name":"Ludhiana"},{"id":"1506","name":"Lunglei"},{"id":"1011","name":"Madhepura"},{"id":"1005","name":"Madhubani"},{"id":"3324","name":"Madurai"},{"id":"2212","name":"Mahasamund"},{"id":"2807","name":"Mahbubnagar"},{"id":"3403","name":"Mahe"},{"id":"0616","name":"Mahendragarh"},{"id":"2404","name":"Mahesana"},{"id":"0939","name":"Mahoba"},{"id":"0957","name":"Mahrajganj"},{"id":"0918","name":"Mainpuri"},{"id":"3205","name":"Malappuram"},{"id":"1906","name":"Maldah"},{"id":"2130","name":"Malkangiri"},{"id":"1501","name":"Mamit"},{"id":"0205","name":"Mandi"},{"id":"2342","name":"Mandla"},{"id":"2319","name":"Mandsaur"},{"id":"2922","name":"Mandya"},{"id":"0315","name":"Mansa"},{"id":"1809","name":"Marigaon"},{"id":"0914","name":"Mathura"},{"id":"0962","name":"Mau"},{"id":"2107","name":"Mayurbhanj"},{"id":"2804","name":"Medak"},{"id":"1915","name":"Medinipur"},{"id":"0907","name":"Meerut"},{"id":"0969","name":"Mirzapur"},{"id":"0310","name":"Moga"},{"id":"1303","name":"Mokokchung"},{"id":"1301","name":"Mon"},{"id":"0904","name":"Moradabad"},{"id":"2302","name":"Morena"},{"id":"0312","name":"Muktsar"},{"id":"2723","name":"Mumbai"},{"id":"2722","name":"Mumbai Suburban"},{"id":"1024","name":"Munger"},{"id":"1907","name":"Murshidabad"},{"id":"0902","name":"Muzaffarnagar"},{"id":"1014","name":"Muzaffarpur"},{"id":"2926","name":"Mysore"},{"id":"2128","name":"Nabarangapur"},{"id":"1910","name":"Nadia"},{"id":"1810","name":"Nagaon"},{"id":"3319","name":"Nagapattinam"},{"id":"0814","name":"Nagaur"},{"id":"2709","name":"Nagpur"},{"id":"0511","name":"Nainital"},{"id":"1027","name":"Nalanda"},{"id":"1807","name":"Nalbari"},{"id":"2808","name":"Nalgonda"},{"id":"3309","name":"Namakkal"},{"id":"2715","name":"Nanded"},{"id":"2701","name":"Nandurbar"},{"id":"2420","name":"Narmada"},{"id":"2340","name":"Narsimhapur"},{"id":"2720","name":"Nashik"},{"id":"2424","name":"Navsari"},{"id":"1036","name":"Nawada"},{"id":"0306","name":"Nawanshahr"},{"id":"2116","name":"Nayagarh"},{"id":"2318","name":"Neemuch"},{"id":"2819","name":"Nellore"},{"id":"0705","name":"New Delhi"},{"id":"3502","name":"Nicobars"},{"id":"2802","name":"Nizamabad"},{"id":"0702","name":"North"},{"id":"1101","name":"North"},{"id":"1820","name":"North Cachar Hills"},{"id":"0703","name":"North East"},{"id":"3001","name":"North Goa"},{"id":"1604","name":"North Tripura"},{"id":"1911","name":"North Twenty Four Parganas"},{"id":"0701","name":"North West"},{"id":"2125","name":"Nuapada"},{"id":"2729","name":"Osmanabad"},{"id":"2010","name":"Pakaur"},{"id":"3206","name":"Palakkad"},{"id":"2002","name":"Palamu"},{"id":"0820","name":"Pali"},{"id":"2417","name":"Panch Mahals"},{"id":"0601","name":"Panchkula"},{"id":"0607","name":"Panipat"},{"id":"2310","name":"Panna"},{"id":"1204","name":"Papum Pare"},{"id":"2717","name":"Parbhani"},{"id":"1001","name":"Pashchim Champaran"},{"id":"2017","name":"Pashchimi Singhbhum"},{"id":"2403","name":"Patan"},{"id":"3212","name":"Pathanamthitta"},{"id":"0317","name":"Patiala"},{"id":"1028","name":"Patna"},{"id":"3316","name":"Perambalur"},{"id":"1308","name":"Phek"},{"id":"0921","name":"Pilibhit"},{"id":"0507","name":"Pithoragarh"},{"id":"3402","name":"Pondicherry"},{"id":"2411","name":"Porbandar"},{"id":"2818","name":"Prakasam"},{"id":"0943","name":"Pratapgarh"},{"id":"3322","name":"Pudukkottai"},{"id":"0105","name":"Pulwama"},{"id":"0111","name":"Punch"},{"id":"2725","name":"Pune"},{"id":"1002","name":"Purba Champaran"},{"id":"2018","name":"Purbi Singhbhum"},{"id":"2118","name":"Puri"},{"id":"1009","name":"Purnia"},{"id":"1914","name":"Puruliya"},{"id":"0928","name":"Rae Bareli"},{"id":"2906","name":"Raichur"},{"id":"2204","name":"Raigarh"},{"id":"2724","name":"Raigarh"},{"id":"2211","name":"Raipur"},{"id":"2334","name":"Raisen"},{"id":"0112","name":"Rajauri"},{"id":"2330","name":"Rajgarh"},{"id":"2409","name":"Rajkot"},{"id":"2209","name":"Rajnandgaon"},{"id":"0825","name":"Rajsamand"},{"id":"3327","name":"Ramanathapuram"},{"id":"0905","name":"Rampur"},{"id":"2014","name":"Ranchi"},{"id":"2806","name":"Rangareddi"},{"id":"2320","name":"Ratlam"},{"id":"2732","name":"Ratnagiri"},{"id":"2127","name":"Rayagada"},{"id":"2314","name":"Rewa"},{"id":"0617","name":"Rewari"},{"id":"1705","name":"Ri Bhoi"},{"id":"0614","name":"Rohtak"},{"id":"1032","name":"Rohtas"},{"id":"0503","name":"Rudraprayag"},{"id":"0307","name":"Rupnagar"},{"id":"2405","name":"Sabar Kantha"},{"id":"2311","name":"Sagar"},{"id":"0901","name":"Saharanpur"},{"id":"1012","name":"Saharsa"},{"id":"2009","name":"Sahibganj"},{"id":"1508","name":"Saiha"},{"id":"3308","name":"Salem"},{"id":"1019","name":"Samastipur"},{"id":"2103","name":"Sambalpur"},{"id":"2735","name":"Sangli"},{"id":"0316","name":"Sangrur"},{"id":"0956","name":"Sant Kabir Nagar"},{"id":"0968","name":"Sant Ravidas Nagar"},{"id":"1017","name":"Saran"},{"id":"2731","name":"Satara"},{"id":"2313","name":"Satna"},{"id":"0810","name":"Sawai Madhopur"},{"id":"2333","name":"Sehore"},{"id":"1401","name":"Senapati"},{"id":"2344","name":"Seoni"},{"id":"1505","name":"Serchhip"},{"id":"2316","name":"Shahdol"},{"id":"0922","name":"Shahjahanpur"},{"id":"2322","name":"Shajapur"},{"id":"1026","name":"Sheikhpura"},{"id":"1003","name":"Sheohar"},{"id":"2301","name":"Sheopur"},{"id":"0211","name":"Shimla"},{"id":"2915","name":"Shimoga"},{"id":"2306","name":"Shivpuri"},{"id":"0951","name":"Shrawasti"},{"id":"1816","name":"Sibsagar"},{"id":"0954","name":"Siddharthnagar"},{"id":"2317","name":"Sidhi"},{"id":"0813","name":"Sikar"},{"id":"2733","name":"Sindhudurg"},{"id":"0210","name":"Sirmaur"},{"id":"0819","name":"Sirohi"},{"id":"0611","name":"Sirsa"},{"id":"1004","name":"Sitamarhi"},{"id":"0924","name":"Sitapur"},{"id":"3323","name":"Sivaganga"},{"id":"1016","name":"Siwan"},{"id":"0209","name":"Solan"},{"id":"2730","name":"Solapur"},{"id":"2123","name":"Sonapur"},{"id":"0970","name":"Sonbhadra"},{"id":"0608","name":"Sonipat"},{"id":"1811","name":"Sonitpur"},{"id":"1103","name":"South"},{"id":"0709","name":"South"},{"id":"1918","name":"South  Twenty Four Parganas"},{"id":"1703","name":"South Garo Hills"},{"id":"3002","name":"South Goa"},{"id":"1602","name":"South Tripura"},{"id":"0708","name":"South West"},{"id":"2811","name":"Srikakulam"},{"id":"0103","name":"Srinagar"},{"id":"0949","name":"Sultanpur"},{"id":"2105","name":"Sundargarh"},{"id":"1006","name":"Supaul"},{"id":"2422","name":"Surat"},{"id":"2408","name":"Surendranagar"},{"id":"2202","name":"Surguja"},{"id":"1402","name":"Tamenglong"},{"id":"1201","name":"Tawang"},{"id":"0504","name":"Tehri Garhwal"},{"id":"2721","name":"Thane"},{"id":"3321","name":"Thanjavur"},{"id":"2423","name":"The Dangs"},{"id":"3311","name":"The Nilgiris"},{"id":"3325","name":"Theni"},{"id":"3301","name":"Thiruvallur"},{"id":"3214","name":"Thiruvananthapuram"},{"id":"3320","name":"Thiruvarur"},{"id":"3328","name":"Thoothukkudi"},{"id":"1405","name":"Thoubal"},{"id":"3207","name":"Thrissur"},{"id":"2308","name":"Tikamgarh"},{"id":"1814","name":"Tinsukia"},{"id":"1213","name":"Tirap"},{"id":"3315","name":"Tiruchirappalli"},{"id":"3329","name":"Tirunelveli"},{"id":"3306","name":"Tiruvannamalai"},{"id":"0822","name":"Tonk"},{"id":"1302","name":"Tuensang"},{"id":"2918","name":"Tumkur"},{"id":"0826","name":"Udaipur"},{"id":"0512","name":"Udham Singh Nagar"},{"id":"0110","name":"Udhampur"},{"id":"2916","name":"Udupi"},{"id":"2321","name":"Ujjain"},{"id":"1408","name":"Ukhrul"},{"id":"2315","name":"Umaria"},{"id":"0207","name":"Una"},{"id":"0926","name":"Unnao"},{"id":"1209","name":"Upper Siang"},{"id":"1206","name":"Upper Subansiri"},{"id":"1904","name":"Uttar Dinajpur"},{"id":"2910","name":"Uttara Kannada"},{"id":"0501","name":"Uttarkashi"},{"id":"2419","name":"Vadodara"},{"id":"1018","name":"Vaishali"},{"id":"2425","name":"Valsad"},{"id":"0967","name":"Varanasi"},{"id":"3304","name":"Vellore"},{"id":"2331","name":"Vidisha"},{"id":"3307","name":"Viluppuram"},{"id":"3326","name":"Virudhunagar"},{"id":"2813","name":"Visakhapatnam"},{"id":"2812","name":"Vizianagaram"},{"id":"2809","name":"Warangal"},{"id":"2708","name":"Wardha"},{"id":"2706","name":"Washim"},{"id":"3203","name":"Wayanad"},{"id":"0707","name":"West"},{"id":"1102","name":"West"},{"id":"1701","name":"West Garo Hills"},{"id":"2815","name":"West Godavari"},{"id":"1202","name":"West Kameng"},{"id":"1704","name":"West Khasi Hills"},{"id":"2327","name":"West Nimar"},{"id":"1207","name":"West Siang"},{"id":"1601","name":"West Tripuraa"},{"id":"1305","name":"Wokha"},{"id":"0603","name":"Yamunanagar"},{"id":"2714","name":"Yavatmal"},{"id":"1304","name":"Zunheboto"}]

    def __diffsoundex(self, query, name, value=4):
        soundex = fuzzy.Soundex(value)
        a = soundex(name)
        b = soundex(query)
        if a[0] == b[0]:
            return abs(int(a[1:]) - int(b[1:]))
        else :
            return abs(int(a[1:]) - int(b[1:])) + 250

    def __chooseBestMarker(self, query, markers, listLength):
        for marker in markers:
            marker.setAttribute("soundex_diff", self.__diffsoundex(marker.getAttribute("name"), query))
        listLength = min(listLength,markers.__len__())
        markers = sorted(markers, cmp=lambda x, y: cmp(x.getAttribute("soundex_diff"), y.getAttribute("soundex_diff")))
        coordinates = []
        q_u = query.upper()
        for marker in markers[:listLength]:
            try:
                coordinates.append(
                    Coordinates(
                        lat = marker.getAttribute("lat"),
                        lng = marker.getAttribute("lng"),
                        name = marker.getAttribute("name").upper(),
                        state = marker.getAttribute("state_ut"),
                        district = marker.getAttribute("district"),
                        sub_district = marker.getAttribute("tahsil"),
                        level = marker.getAttribute("level"),
                        quality = "Taken_Help_Of_Phones",
                        given_query=q_u
                    ))
            except ValueError:
                pass
        return coordinates

    def __getVillageMarkersFromWeb(self,query, state_code=None, district_code=None):
        stateString = '"state":"' + state_code + '"' if state_code is not None else ""
        districtString = ',"district":"' + district_code + '"' if district_code is not None else ""
        f_param = '{' + stateString + districtString + '}'
        params = urllib.urlencode({"q":query,"f":f_param})
        url = "http://india.csis.u-tokyo.ac.jp/geocode-cgi/census_ajax_json.cgi"
        http = httplib2.Http()
        response, markers_xml = http.request(url, "POST", params)
        dom = minidom.parseString(markers_xml)
        markers = dom.getElementsByTagName("marker")
        return markers

    def __getStateCode(self, state_name):
        states = [state["name"] for state in self.__states_with_id]
        soundex_diffs = [self.__diffsoundex(state_name, state) for state in states]
        min_index, min_value = min(enumerate(soundex_diffs), key=operator.itemgetter(1))
        if min_value < 200:
            return self.__states_with_id[min_index]["id"]
        else:
            return ""

    def __getDistrictCode(self, district_name, state_code):
        filtered_districts_with_id = filter(lambda x: x["id"][0:2] == state_code, self.__districts_with_id)
        districts = [district["name"] for district in filtered_districts_with_id]
        soundex_diffs = [self.__diffsoundex(district_name, district) for district in districts]
        min_index, min_value = min(enumerate(soundex_diffs), key=operator.itemgetter(1))
        if min_value < 200:
            return filtered_districts_with_id[min_index]["id"]
        else:
            return ""

    def getCoordinates(self, query,listLength=1):
        if type(listLength) != int or listLength < 1:
            listLength = 1
        ##Size of listLength doesnot make sense to be more than 10
        listLength = max(listLength, 10)
        markers = self.__getVillageMarkersFromWeb(query, self.state_code, self.district_code)
        return self.__chooseBestMarker(query, markers, listLength)
